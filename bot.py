import os
import logging
import asyncio
from datetime import datetime, time
import random
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# Настройка логирования
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# Ваш токен бота. Он будет подставлен из переменной окружения!
TOKEN = os.getenv('8425103412:AAEoB-y6mxML2vZukZOTubljCtG9NTPAxDk')  # Очень важно! Код читает токен из переменной, а не из файла.

# ID чата вашей девушки (нужно заменить на реальный)
GIRLFRIEND_CHAT_ID = "5391859020"  # Например: "123456789"

# Список из 100 комплиментов
COMPLIMENTS = [
    "Ты самое красивое существо на планете!",
    "Твоя улыбка делает мой день лучше!",
    "У тебя невероятно доброе сердце!",
    "Ты вдохновляешь меня становиться лучше!",
    "Твои глаза просто завораживают!",
    "С тобой я чувствую себя самым счастливым человеком!",
    "Ты невероятно умна и талантлива!",
    "Твоё чувство юмора всегда поднимает мне настроение!",
    "Ты прекрасна внутри и снаружи!",
    "Рядом с тобой время останавливается!",
    "Ты моя самая большая удача в жизни!",
    "Твоя забота обо мне бесценна!",
    "У тебя самый милый смех на свете!",
    "Ты справляешься с трудностями лучше любого супергероя!",
    "Твоя поддержка значит для меня всё!",
    "Ты прекрасно готовишь!",
    "С тобой можно говорить обо всём на свете!",
    "Ты моё самое большое счастье!",
    "Твоя уверенность в себе восхищает!",
    "Ты делаешь мир вокруг себя лучше!",
    "Ты невероятно креативна!",
    "Твоя страсть к жизни заразительна!",
    "Ты самая лучшая девушка на свете!",
    "Твоя нежность меня растопляет!",
    "Ты моя муза и вдохновение!",
    "С тобой мне не страшны никакие трудности!",
    "Ты прекрасно выглядишь в любое время дня!",
    "Твоя мудрость поражает!",
    "Ты самая заботливая девушка на свете!",
    "Твоя энергия заряжает всех вокруг!",
    "Ты идеальна такой, какая ты есть!",
    "Твои объятия - моё самое безопасное место!",
    "Ты преодолеваешь любые препятствия с изяществом!",
    "Твоя душа так же прекрасна, как и внешность!",
    "Ты моя самая большая мечта, которая сбылась!",
    "Твоя решительность восхищает!",
    "С тобой хочется conquister весь мир!",
    "Ты прекрасный собеседник!",
    "Твоя щедрость не знает границ!",
    "Ты сияешь изнутри!",
    "Твоя любовь делает меня лучше!",
    "Ты самая обаятельная девушка!",
    "Твоя красота не поддаётся описанию!",
    "Ты справляешься со всем так легко и gracefully!",
    "Твоё присутствие делает любое место лучше!",
    "Ты моя тихая гавань в бурном океане жизни!",
    "Твоя индивидуальность восхищает!",
    "Ты самая романтичная девушка!",
    "Твоя сила воли впечатляет!",
    "Ты преображаешь всё вокруг себя!",
    "Твоя скромность только подчёркивает твои достоинства!",
    "Ты находишь красоту в мелочах!",
    "Твоя целеустремлённость вдохновляет!",
    "Ты создана из света и добра!",
    "Твоя искренность покоряет сердца!",
    "Ты умеешь слушать и слышать!",
    "Твоя фантазия безгранична!",
    "Ты преданный и верный человек!",
    "Твоё терпение достойно восхищения!",
    "Ты видишь возможности там, где другие видят препятствия!",
    "Твоя улыбка лечит душу!",
    "Ты находишь правильные слова в нужный момент!",
    "Твоя красота с каждым днём только расцветает!",
    "Ты умеешь создавать уют вокруг себя!",
    "Твоя интуиция никогда не подводит!",
    "Ты мастерски справляешься с любыми задачами!",
    "Твоя жизнерадостность заразительна!",
    "Ты прекрасна даже без макияжа!",
    "Твоя прямота и честность вызывают уважение!",
    "Ты умеешь прощать и понимать!",
    "Твоя элегантность не остаётся незамеченной!",
    "Ты находишь время для всех, кто тебе дорог!",
    "Твоя скромность - это твоя сила!",
    "Ты умеешь радоваться мелочам!",
    "Твоя внутренняя гармония ощущается всеми вокруг!",
    "Ты создаёшь прекрасные воспоминания!",
    "Твоя открытость новому впечатляет!",
    "Ты прекрасно справляешься с многозадачностью!",
    "Твоя натура полна контрастов и загадок!",
    "Ты умеешь правильно расставлять приоритеты!",
    "Твоя способность к сопереживанию - это дар!",
    "Ты находишь нестандартные решения проблем!",
    "Твоя верность не знает границ!",
    "Ты умеешь создавать праздник из обычного дня!",
    "Твоя натура - это сочетание силы и нежности!",
    "Ты вдохновляешь меня на подвиги!",
    "Твоя непосредственность освежает!",
    "Ты умеешь признавать свои ошибки!",
    "Твоя способность адаптироваться впечатляет!",
    "Ты видишь хорошее в каждом человеке!",
    "Твоя скромная улыбка сводит с ума!",
    "Ты умеешь хранить секреты!",
    "Твоя внутренняя сила восхищает!",
    "Ты делаешь каждый мой день особенным!",
    "Твоя красота заставляет остановиться и замереть!",
    "Ты умеешь правильно расставлять акценты в жизни!",
    "Твоя душа поёт, и я слышу её музыку!",
    "Ты самое лучшее, что со мной случилось!"
]

async def send_compliment(context: ContextTypes.DEFAULT_TYPE):
    """Отправляет случайный комплимент"""
    try:
        compliment = random.choice(COMPLIMENTS)
        await context.bot.send_message(chat_id=GIRLFRIEND_CHAT_ID, text=compliment)
        logger.info(f"Отправлен комплимент: {compliment}")
    except Exception as e:
        logger.error(f"Ошибка при отправке комплимента: {e}")

async def schedule_compliments(context: ContextTypes.DEFAULT_TYPE):
    """Планирует отправку комплиментов на случайное время в течение дня"""
    # Отменяем предыдущие задания
    current_jobs = context.job_queue.get_jobs_by_name("compliment_job")
    for job in current_jobs:
        job.schedule_removal()
    
    # Планируем отправку на случайное время между 9:00 и 21:00
    hour = random.randint(9, 21)
    minute = random.randint(0, 59)
    
    # Создаем время отправки
    send_time = time(hour, minute)
    
    # Добавляем задание в очередь
    context.job_queue.run_daily(
        send_compliment, 
        send_time, 
        name="compliment_job",
        data=None
    )
    
    logger.info(f"Комплимент запланирован на {hour:02d}:{minute:02d}")

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Обработчик команды /start"""
    user = update.effective_user
    if str(user.id) == GIRLFRIEND_CHAT_ID:
        await update.message.reply_text("Привет, любимая! Я буду отправлять тебе комплименты в течение дня!")
    else:
        await update.message.reply_text("Привет! Этот бот создан для особенной девушки!")
    
    # Планируем отправку комплиментов
    await schedule_compliments(context)

async def compliment_now(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Отправляет комплимент немедленно (команда /compliment)"""
    user = update.effective_user
    if str(user.id) == GIRLFRIEND_CHAT_ID:
        await send_compliment(context)
    else:
        await update.message.reply_text("Эта команда только для особенной девушки!")

def main():
    # Создаем Application
    application = Application.builder().token(TOKEN).build()
    
    # Добавляем обработчики
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("compliment", compliment_now))
    
    # Запускаем бота
    application.run_polling()

if __name__ == '__main__':
    main()
